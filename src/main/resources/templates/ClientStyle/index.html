<!DOCTYPE html>
<html lang="en">

<head th:replace="/ClientStyle/common/head::head">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="assets/css/style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
        integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
    <link rel="stylesheet" href="assets/css/chosen.css">
    <script src="https://use.fontawesome.com/697d84ba14.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.1.js"
        integrity="sha256-3zlB5s2uwoUzrXK3BT7AX3FyvojsraNFxCc2vC/7pNI=" crossorigin="anonymous"></script>
    <!-- <script src="assets/js/mutiple-select-js.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.1.js" integrity="sha256-3zlB5s2uwoUzrXK3BT7AX3FyvojsraNFxCc2vC/7pNI="
    crossorigin="anonymous"></script>
  <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/css/bootstrap-select.css" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/js/bootstrap-select.min.js"></script>
  <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script> -->
    <!-- <script src="//code.jquery.com/jquery-1.11.1.min.js"></script> -->
    <title>Document</title>
</head>

<body>
    <header th:replace="/ClientStyle/common/header::header">
        <div class="header-search">
            <div class="container">
                <div class="row">
                    <div class="col-md-3">
                        <div class="logo">
                            <img src="assets/image/logo/logo4.png" alt="">
                        </div>

                    </div>
                    <div class="col-md-8">
                        <div class="search">
                            <form action="" method="get" class="search-box">
                                <input type="text" placeholder="Nhập Tên Cây Dược Liệu Cần Tìm">
                                <button type="submit"><i class="fa fa-search" aria-hidden="true"></i></button>
                            </form>
                            <div class="search-voice"><a href="#"><i class="fa fa-microphone"
                                        aria-hidden="true"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="header">
            <div class="container">
                <div class="row">
                    <div class="col-md-8">
                        <ul>
                            <li class="title"> <a href="#">Trang Chủ</a> </li>
                            <li class="title"> <a href="#">Tra Cứu Dược Liệu</a>

                            </li>
                            <li class="title"> <a href="#">Giới Thiệu</a></li>
                            <li class="title"><a href="#">Bài Viết</a></li>
                        </ul>
                    </div>
                    <div class="col-md-4 d-flex justify-content-end">
                        <ul>
                            <li class="title"><a href="#">Đăng Nhập</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="search-space">
        <div class="container">
            <div class="row">
                <h3 class="col-md-12 title d-flex justify-content-center">Góc Tra Cứu</h3>
            </div>
            <div class="row tool-search">
                <div class="col-md-6 d-flex justify-content-end">
                    <div class="img-search">
                        <a href=""><img th:src="@{/ClientStyle/assets/image/logo/mortar.png}" alt=""></a>
                        <p class="img-search-title"> <a href="#"> Tra Cứu Cây Dược Liệu</a></p>
                    </div>
                </div>
                <div class="col-md-6 d-flex justify-content-start">
                    <div class="img-search">
                        <a href="#"><img th:src="@{/ClientStyle/assets/image/logo/picture.png}" alt="" id="button-modal"></a>
                        <p class="img-search-title"> <a href="#">Tra Cứu Bằng Hình Ảnh</a> </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="space"></div>
    <div class="herbs-list">
        <div class="container">
            <div class="row">
                <h3 class="col-md-12 title d-flex justify-content-center">Danh Sách Cây Dược Liệu</h3>
            </div>
            <div class="row">
            	<th:block  th:each="object:${cayduoclieu}">
	            	<div class="col-md-3" th:if="${object.getHinh().size()==3}">
	                    <div class="box">
	                        <div class="box-img">
	                            <img th:src="@{'/ClientStyle/assets/img/AnhcayDuocLieu/'+${object.getHinh().get(0).getTenhinh()}}" alt="">
	                        </div>
	                        <div class="box-title">
	                            <p><a th:text="${object.getTenduoclieu()}" th:href="@{/TraCuuCayDuocLieu/Chi-Tiet-Cay-Duoc-Lieu ( id=${object.getMaduoclieu()} ) }">Cây Bán Hạ Nam</a></p>
	                        </div>
	                    </div>
	                </div>
            	</th:block>
                
                <!-- <div class="col-md-3">
                    <div class="box">
                        <div class="box-img">
                            <img src="assets/image/Anhcay/herb00539.jpeg" alt="">
                        </div>
                        <div class="box-title">
                            <p><a href="#">Cây Bán Hạ Nam</a></p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="box">
                        <div class="box-img">
                            <img src="assets/image/Anhcay/herb00539.jpeg" alt="">
                        </div>
                        <div class="box-title">
                            <p><a href="#">Cây Bán Hạ Nam</a></p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="box">
                        <div class="box-img">
                            <img src="assets/image/Anhcay/herb00539.jpeg" alt="">
                        </div>
                        <div class="box-title">
                            <p><a href="#">Cây Bán Hạ Nam</a></p>
                        </div>
                    </div>
                </div>
            </div> -->
         <!--    <div class="row">
                <div class="col-md-3">
                    <div class="box">
                        <div class="box-img">
                            <img src="assets/image/Anhcay/herb00539.jpeg" alt="">
                        </div>
                        <div class="box-title">
                            <p><a href="#">Cây Bán Hạ Nam</a></p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="box">
                        <div class="box-img">
                            <img src="assets/image/Anhcay/herb00539.jpeg" alt="">
                        </div>
                        <div class="box-title">
                            <p><a href="#">Cây Bán Hạ Nam</a></p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="box">
                        <div class="box-img">
                            <img src="assets/image/Anhcay/herb00539.jpeg" alt="">
                        </div>
                        <div class="box-title">
                            <p><a href="#">Cây Bán Hạ Nam</a></p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="box">
                        <div class="box-img">
                            <img src="assets/image/Anhcay/herb00539.jpeg" alt="">
                        </div>
                        <div class="box-title">
                            <p><a href="#">Cây Bán Hạ Nam</a></p>
                        </div>
                    </div>
                </div>
            </div> -->
         <!--    <div class="row">
                <div class="col-md-3">
                    <div class="box">
                        <div class="box-img">
                            <img src="assets/image/Anhcay/herb00539.jpeg" alt="">
                        </div>
                        <div class="box-title">
                            <p><a href="#">Cây Bán Hạ Nam</a></p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="box">
                        <div class="box-img">
                            <img src="assets/image/Anhcay/herb00539.jpeg" alt="">
                        </div>
                        <div class="box-title">
                            <p><a href="#">Cây Bán Hạ Nam</a></p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="box">
                        <div class="box-img">
                            <img src="assets/image/Anhcay/herb00539.jpeg" alt="">
                        </div>
                        <div class="box-title">
                            <p><a href="#">Cây Bán Hạ Nam</a></p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="box">
                        <div class="box-img">
                            <img src="assets/image/Anhcay/herb00539.jpeg" alt="">
                        </div>
                        <div class="box-title">
                            <p><a href="#">Cây Bán Hạ Nam</a></p>
                        </div>
                    </div>
                </div>
            </div> -->
           <!--  <div class="row">
                <div class="col-md-3">
                    <div class="box">
                        <div class="box-img">
                            <img src="assets/image/Anhcay/herb00539.jpeg" alt="">
                        </div>
                        <div class="box-title">
                            <p><a href="#">Cây Bán Hạ Nam</a></p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="box">
                        <div class="box-img">
                            <img src="assets/image/Anhcay/herb00539.jpeg" alt="">
                        </div>
                        <div class="box-title">
                            <p><a href="#">Cây Bán Hạ Nam</a></p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="box">
                        <div class="box-img">
                            <img src="assets/image/Anhcay/herb00539.jpeg" alt="">
                        </div>
                        <div class="box-title">
                            <p><a href="#">Cây Bán Hạ Nam</a></p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="box">
                        <div class="box-img">
                            <img src="assets/image/Anhcay/herb00539.jpeg" alt="">
                        </div>
                        <div class="box-title">
                            <p><a href="#">Cây Bán Hạ Nam</a></p>
                        </div>
                    </div>
                </div>
            </div> -->
            
        </div>
        <div class="pagination row d-flex justify-content-start">
              <div class="col-md-12">
            	 <li th:if="${page_present}>1" class="page-item "><a class="page-link active"
                        th:href="@{/Trang-Chu (page=${page_present}-1)}">Trước
                    </a></li>
                <!-- 	<th:block th:each="i: ${#numbers.sequence(1,3)}"> -->
                <li th:if="${page_present}<=${count}" class="page-item active"><a class="page-link active"
                        th:text="${page_present}" th:href="@{/Trang-Chu(page=${page_present})}"><span
                            class="sr-only">(current)</span> </a></li>
                <li th:if="${page_present}+1<=${count}"><a class="page-link" th:text="${page_present}+1"
                        th:href="@{/Trang-Chu(page=${page_present}+1)}"><span
                            class="sr-only">(current)</span> </a></li>
                <li th:if="${page_present}+2<=${count}"><a class="page-link" th:text="${page_present}+2"
                        th:href="@{/Trang-Chu(page=${page_present}+1)}"><span
                            class="sr-only">(current)</span> </a></li>
                <!-- </th:block> -->
                <li th:if="${page_present}<${count}" class="page-item "><a class="page-link active"
                        th:href="@{/Trang-Chu(page=${page_present}+1)}">Kế
                        Tiếp </a></li>
             </div>  
         </div>
    </div>
    <div id="space"></div>
    <div id="footer" th:replace="/ClientStyle/common/footer::footer">
        <div class="container">
            <div class="row d-flex justify-content-center">
                <p id="footer-content">Nội dung của website này chỉ mang tính chất tham khảo. Vui lòng hỏi ý kiến của
                    bác sĩ</p>
            </div>
        </div>
    </div>


    <div class="modal" id="modal">
        <div class="file-upload">
            <button class="file-upload-btn" type="button" onclick="$('.file-upload-input').trigger( 'click' )">Thêm
                Ảnh</button>

            <div class="image-upload-wrap">
                <input class="file-upload-input" type='file' onchange="readURL(this);" accept="image/*" />
                <div class="drag-text">
                    <h4>Kéo Thả Hoặc Chọn Ảnh</h4>
                </div>
            </div>
            <div class="file-upload-content">
                <img class="file-upload-image" id="file-upload-image" src="#" alt="your image" />
                <div class="loader-frame">
                    <div class="loader"></div>
                </div>
                <div class="predict-frame"><a id="predict" href="#"></a><span><i class="fa fa-volume-up" id="sound"
                            onclick="sound()" aria-hidden="true"></i></span></div>
                <div class="image-title-wrap">
                    <button type="button" onclick="removeUpload()" class="remove-image">
                        Xóa Ảnh <span class="image-title">Tải Ảnh Lên</span>
                    </button>
                </div>
            </div>
            <div class="btn-upload" onclick="init()">
                <button type="submit">Tra Cứu</button>
            </div>
            <div class="close" id="close" style="color: black;">
                <i class="fa fa-times" aria-hidden="true"></i>
            </div>
        </div>
    </div>
</body>
<script>
    var main_image = document.getElementsByClassName("main-image");
    var thumbnail = document.getElementsByClassName("thumbnail");
    for (var i = 0; i < thumbnail.length; i++) {
        thumbnail[i].addEventListener("click", function () {
            main_image[0].src = this.src;
            // this.classList.add("active-image");
        })
    }

    var recommentto = document.querySelectorAll(".repcomment-to");
    var repcomment = document.querySelectorAll(".repcomment");
    console.log(repcomment);
    for (let i = 0; i < recommentto.length; i++) {
        recommentto[i].addEventListener("click", function () {
            repcomment[i].style.display = "block";
        })
    }

    var btnmodal = document.getElementById("button-modal");
    var modal = document.getElementById("modal");
    btnmodal.addEventListener("click", function () {
        modal.style.display = "flex";
    })

    var close = document.getElementById("close");
    close.addEventListener("click", function () {
        modal.style.display = "none";
    })

    function readURL(input) {
        if (input.files && input.files[0]) {

            var reader = new FileReader();

            reader.onload = function (e) {
                $('.image-upload-wrap').hide();

                $('.file-upload-image').attr('src', e.target.result);
                $('.file-upload-content').show();

                $('.image-title').html(input.files[0].name);
            };

            reader.readAsDataURL(input.files[0]);

        } else {
            removeUpload();
        }
    }

    function removeUpload() {
        $('.file-upload-input').replaceWith($('.file-upload-input').clone());
        $('.file-upload-content').hide();
        $('.image-upload-wrap').show();
        $('#predict').hide();
        $(".loader-frame").hide();
        $('.predict-frame').hide();
    }
    $('.image-upload-wrap').bind('dragover', function () {
        $('.image-upload-wrap').addClass('image-dropping');
    });
    $('.image-upload-wrap').bind('dragleave', function () {
        $('.image-upload-wrap').removeClass('image-dropping');
    });

</script>
<script>
    const URL = "/ClientStyle/tmp/";
    var image = document.getElementById("file-upload-image");
    let model, labelContainer, maxPredictions;
    var tencayduoclieu;

    async function init() {
        if (document.getElementsByTagName("input")[1].value) {
            $(".loader-frame").css('display', 'flex');
        }
        const modelURL = URL + "model.json";
        const metadataURL = URL + "metadata.json";

        model = await tmImage.load(modelURL, metadataURL);
        maxPredictions = model.getTotalClasses();
        console.log(maxPredictions);
        prediction = await model.predict(image);
        // console.log(prediction);
        console.log(model.className);

        let max = 0;
        let position = 0;
        for (let i = 0; i < maxPredictions; i++) {
            if (prediction[i].probability.toFixed(2) > max) {
                max = prediction[i].probability.toFixed(2);
                position = i;

            }
            console.log(prediction[i].className);
            // console.log(prediction[i].className + ":" + prediction[i].probability.toFixed(2));
        }
        max = max * 100;
        tencayduoclieu = prediction[position].className;
        console.log(prediction[position].className + ":" + max + "%");
        if (document.getElementsByTagName("input")[1].value) {
            $.ajax({
                type: "GET",
                contentType: "application/json",
                url: "/Tra-Cuu-Cay-Duoc-Lieu-Theo-Ten/" + tencayduoclieu,
                success: function (data) {
                    let a = JSON.stringify(data[0].tenduoclieu);
                    $("#predict").show();
                    $('.predict-frame').show();
                    if( data[0].maduoclieu == 0 ) {
                    	 $("#predict").text("Không Tìm Thấy");
                    }
                    else {
                    	 $("#predict").text(data[0].tenduoclieu + " (" + max + "%) ");
                    }
                    $(".loader-frame").hide();
                    $("#predict").attr("href", "/TraCuuCayDuocLieu/Chi-Tiet-Cay-Duoc-Lieu?id=" + data[0].maduoclieu);

                },
                error: function (data_e) {
                	$("#predict").show();
                    $('.predict-frame').show()
                	$("#predict").text("Không Tìm Thấy");
                    $(".loader-frame").hide();
                }
            })
        } 
    }
    function sound() {
        let s = $("#predict").text();
        responsiveVoice.speak(s, "Vietnamese Male");
    }
</script>

</html>